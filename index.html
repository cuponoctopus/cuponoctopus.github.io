<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>CÃ³digo descuento Octopus Energy</title>
  <meta name="description" content="Calcula tu ahorro estimado con Octopus Energy en segundos.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="canonical" href="https://cuponoctopus.github.io/">
  <style>
    body {font-family: system-ui, sans-serif; max-width:700px; margin:auto; padding:20px; line-height:1.6;}
    h1 {color:#009688;}
    label {display:block; margin-top:10px; font-weight:600;}
    input {width:100%; padding:8px; border:1px solid #ccc; border-radius:6px;}
    button {background:#009688; color:white; border:none; padding:10px 16px; border-radius:6px; margin-top:15px; cursor:pointer;}
    button:hover {opacity:0.9;}
    .resultado {margin-top:20px; padding:16px; border-radius:8px; background:#f4f4f4;}
    .mejor {color:#2e7d32;}
    .peor {color:#c62828;}
    footer {margin-top:30px; font-size:0.9rem; color:#666;}
  </style>
</head>
<body>
  <h1 id="titulo">CÃ³digo descuento Octopus Energy</h1>
  <p>Compara rÃ¡pidamente cuÃ¡nto pagarÃ­as con las tarifas <strong>Octopus 3</strong> y <strong>Relax</strong>.</p>

  <form id="calc">
    <label>DÃ­as del periodo</label>
    <input type="number" id="dias" value="30" min="1">

    <label>Potencia Punta (kW)</label>
    <input type="number" id="pot_p1" step="0.01">

    <label>Potencia Valle (kW)</label>
    <input type="number" id="pot_p2" step="0.01">

    <label>Consumo Punta (kWh)</label>
    <input type="number" id="kwh_p" step="0.1">

    <label>Consumo Llano (kWh)</label>
    <input type="number" id="kwh_l" step="0.1">

    <label>Consumo Valle (kWh)</label>
    <input type="number" id="kwh_v" step="0.1">

    <label>Lo que pagas ahora (â‚¬ / mes)</label>
    <input type="number" id="actual" step="0.01">

    <button type="button" id="btnCalcular">Calcular ahorro</button>
  </form>

  <div class="resultado" id="resultado"></div>

  <p><a id="enlaceRef" href="#" target="_blank" rel="nofollow sponsored">ðŸ‘‰ Usar mi cÃ³digo de invitaciÃ³n de Octopus</a></p>

  <footer>
    <p id="fecha"></p>
    <p>DivulgaciÃ³n: este enlace es de referido, por lo que ambos recibimos crÃ©dito en factura.</p>
  </footer>

  <script>
    let cfg={};
    fetch('config.json')
      .then(r=>r.json())
      .then(data=>{
        cfg=data;
        document.getElementById('titulo').textContent =
          `CÃ³digo descuento Octopus Energy â€” ${cfg.mes.charAt(0).toUpperCase()+cfg.mes.slice(1)} ${cfg.ano}`;
        document.getElementById('enlaceRef').href = cfg.referido;
        document.getElementById('fecha').textContent = `Datos actualizados: ${cfg.mes} ${cfg.ano}`;
      });

    function calcular(){
      const dias = +document.getElementById('dias').value;
      const potP1 = +document.getElementById('pot_p1').value;
      const potP2 = +document.getElementById('pot_p2').value;
      const kwhP = +document.getElementById('kwh_p').value;
      const kwhL = +document.getElementById('kwh_l').value;
      const kwhV = +document.getElementById('kwh_v').value;
      const actual = +document.getElementById('actual').value;

      if(!cfg.tarifas){ alert("Esperando datos del archivo config.json"); return; }

      const t = cfg.tarifas;
      const base = (p1,p2,eP,eL,eV)=>((p1*potP1+p2*potP2)*dias)+(eP*kwhP+eL*kwhL+eV*kwhV);
      const base3 = base(t.octopus_3.potencia_p1,t.octopus_3.potencia_p2,t.octopus_3.energia_punta,t.octopus_3.energia_llano,t.octopus_3.energia_valle);
      const baseR = ((t.relax.potencia_p1*potP1 + t.relax.potencia_p2*potP2)*dias) + ((kwhP+kwhL+kwhV)*t.relax.energia);

      const addTaxes = base => {
        const imp = base * cfg.impuesto_electrico;
        const cont = cfg.alquiler_dia * dias;
        const total = (base + imp + cont) * (1+cfg.iva);
        return total;
      }

      const total3 = addTaxes(base3);
      const totalR = addTaxes(baseR);

      const dif3 = total3 - actual;
      const difR = totalR - actual;
      const pct3 = (dif3/actual*100).toFixed(1);
      const pctR = (difR/actual*100).toFixed(1);

      const res = document.getElementById('resultado');
      res.innerHTML = `
        <h3>Resultados</h3>
        <p>ðŸ’¡ Tu factura actual: <strong>${actual.toFixed(2)} â‚¬</strong></p>
        <p>âš¡ Octopus 3: <strong>${total3.toFixed(2)} â‚¬</strong> 
          <span class="${dif3<0?'mejor':'peor'}">(${dif3<0?'ahorras':'pagas'} ${Math.abs(dif3).toFixed(2)} â‚¬ / ${Math.abs(pct3)}%)</span></p>
        <p>ðŸŒ¿ Octopus Relax: <strong>${totalR.toFixed(2)} â‚¬</strong> 
          <span class="${difR<0?'mejor':'peor'}">(${difR<0?'ahorras':'pagas'} ${Math.abs(difR).toFixed(2)} â‚¬ / ${Math.abs(pctR)}%)</span></p>
      `;
    }

    document.getElementById('btnCalcular').addEventListener('click', calcular);
  </script>
</body>
</html>
